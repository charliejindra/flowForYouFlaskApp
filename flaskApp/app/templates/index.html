<link rel="stylesheet" type="text/css" href="{{ url_for('static',filename='css/style.css') }}">

{% extends "base.html" %}

{% block content %}

<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-app.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-firestore.js"></script>

<script>


        // Initialize and add the map
function initMap() {
        // Creates the map, centered on Kent State University
        var kent_State = {lat: 41.1406508, lng: -81.3461343};
        var map = new google.maps.Map(
            document.getElementById('map'), {zoom: 15, center: kent_State});
    
        infoWindow = new google.maps.InfoWindow;

        // starts services to calculate distance between your location and dispensers
        dms = new google.maps.DistanceMatrixService();
        dirService = new google.maps.DirectionsService();
        dirRenderer = new google.maps.DirectionsRenderer({preserveViewport:true});

        // for testing when you're not on Kent's campus
        // simply set the pos variable below to testLocations[i] with i being 0 to 3
        var testPositions = [
            {lat:41.148161, lng:-81.344848}, // on williams drive
            {lat: 41.144162,lng: -81.341628}, // near aeronautics bldg
            {lat:41.147064, lng:-81.339513}, // on eastway drive
            {lat:41.149772, lng:-81.346146} //janik drive
        ];

        // var pos = { 
        //             lat: position.coords.latitude,
        //             lng: position.coords.longitude
        //         };
        var pos = testPositions[2];
        console.log(pos);

        // Try HTML5 geolocation.
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                var pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };

            infoWindow.setPosition(pos);
            infoWindow.setContent('Location found.');
            infoWindow.open(map);
            map.setCenter(pos);

            }, function() {
                handleLocationError(true, infoWindow, map.getCenter());
            });

        } else {
            // Browser doesn't support Geolocation
            handleLocationError(false, infoWindow, map.getCenter());
        }

    function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
                    'Error: The Geolocation service failed.' :
                    'Error: Your browser doesn\'t support geolocation.');
        infoWindow.open(map);
    }

        var dispensers = [
        
        // This location will be removed once we get all the dispenser locations.
        ['Kent State University', 41.1406508, -81.3461343, '<h1><b>Kent State University</b></h1>' 
        + '<p><b>More Information:</b>' + '<a href="https://www.kent.edu/">'+
        ' https://www.kent.edu/</a>'],
        
        ['Student Recreation Center', 41.141588, -81.340043, '<h1><b>Student Recreation and Wellness Center</b></h1>'
        + '<p id="dispenserInformation"><b>Dispenser Information:</b>' + ' Located in the basement locker rooms.</p>'
        + '<p><b>More Information:</b>' + '<a href="https://www.kent.edu/recservices">'+
        ' https://www.kent.edu/recservices</a>'],
        ];
        
        var infowindow = new google.maps.InfoWindow();

        for (i = 0; i < dispensers.length; i++) {  
        marker = new google.maps.Marker({
        position: new google.maps.LatLng(dispensers[i][1], dispensers[i][2]),
        map: map
        });

        google.maps.event.addListener(marker, 'click', (function(marker, i) {
        return function() {
          infowindow.setContent(dispensers[i][3]);
          infowindow.open(map, marker);
        }
        })(marker, i));

         }
}
</script>

<script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDgh8GWzkyvEprIotnrv-9ZYWvNQXpBCT8&callback=initMap">
</script>

<div id="mapNavContainer">
    <div id="map"></div>
        <ul id="navBarMap">
            <li><a class="active" href="/index">Main Menu</a></li>
            <li><a href="/about">About</a></li>
            <li><a href="/resources">Resources</a></li>
            <li><a href="/settings">Settings</a></li>
        </ul>
</div>




<script>
  // Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyCDD-Y_2pFxNWukf-bkdWDmlQD-mqSYBwk",
    authDomain: "ninja-firestore-tut-470a6.firebaseapp.com",
    databaseURL: "https://ninja-firestore-tut-470a6.firebaseio.com",
    projectId: "ninja-firestore-tut-470a6",
    storageBucket: "ninja-firestore-tut-470a6.appspot.com",
    messagingSenderId: "187246912286",
    appId: "1:187246912286:web:5c0b3b7a22b2d3180a9f0f",
    measurementId: "G-MLY5N0Z7R1"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  db.settings({ timestampsInSnapshots: true })
  //firebase.analytics();
</script>
<script>
    const dispensaryList = document.querySelector('#navBarMap');

function renderDispensary(doc) {
    let li = document.createElement('li');
    let building = document.createElement('span');

    li.setAttribute('data-id', doc.id);
    name.textContent = doc.data().building;

    li.appendChild(building);

    dispensaryList.appendChild(li);
}

db.collection('dispensaries').get().then((snapshot) => {
    snapshot.docs.forEach(doc => {
        renderDispensary(doc);
    })

})
</script>
{% endblock %}