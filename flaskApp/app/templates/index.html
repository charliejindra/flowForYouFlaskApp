<link rel="stylesheet" type="text/css" href="{{ url_for('static',filename='css/style.css') }}">

{% extends "base.html" %}

{% block content %}

<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-app.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-firestore.js"></script>

<script>


        // Initialize and add the map
function initMap() {
        // Creates the map, centered on Kent State University
        var kent_State = {lat: 41.1406508, lng: -81.3461343};
        var map = new google.maps.Map(
            document.getElementById('map'), {zoom: 15, center: kent_State});
    
        infoWindow = new google.maps.InfoWindow;

        // starts services to calculate distance between your location and dispensers
        dms = new google.maps.DistanceMatrixService();
        dirService = new google.maps.DirectionsService();
        dirRenderer = new google.maps.DirectionsRenderer({preserveViewport:true});

        var pos = { 
                    //temporary fake location, comment this and uncomment next two lines for actual location use
                    lat: 41.148132,
                    lng: -81.344246
                    //lat: position.coords.latitude,
                    //lng: position.coords.longitude
                };

        // Try HTML5 geolocation.
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                pos = { 
                    //temporary fake location, comment this and uncomment next two lines for actual location use
                    lat: 41.148132,
                    lng: -81.344246
                    //lat: position.coords.latitude,
                    //lng: position.coords.longitude
                };

            infoWindow.setPosition(pos);
            
            infoWindow.setContent('Location found.');
            infoWindow.open(map);
            map.setCenter(pos);

            }, function() {
                handleLocationError(true, infoWindow, map.getCenter());
            });

        } else {
            // Browser doesn't support Geolocation
            handleLocationError(false, infoWindow, map.getCenter());
        }

    function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
                    'Error: The Geolocation service failed.' :
                    'Error: Your browser doesn\'t support geolocation.');
        infoWindow.open(map);
    }

        var dispensers = [
        
        ['Student Recreation Center', 41.141588, -81.340043, '<h1><b>Student Recreation and Wellness Center</b></h1>'
        + '<p id="dispenserInformation"><b>Dispenser Information:</b>' + ' Located in the basement locker rooms.</p>'
        + '<p><b>More Information:</b>' + '<a href="https://www.kent.edu/recservices">'+
        ' https://www.kent.edu/recservices</a>'],

        ['Aeronautics and Technology Building', 41.144371, -81.341203, '<h1><b>Aeronautics and Technology Building</b></h1>'
        + '<p id="dispenserInformation"><b>Dispenser Information:</b>' + ' Located on the first floor.</p>'
        + '<p><b>Gender:</b>' + ' Female</p>'],

        ['Math and Computer Science Building', 41.145092, -81.341406, '<h1><b>Math and Computer Science Building</b></h1>'],

        ['Henderson Hall', 41.145236, -81.340086, '<h1><b>Henderson Hall</b></h1>'],

        ['Cunningham Hall', 41.146039, -81.341202, '<h1><b>Cunningham Hall</b></h1>'],

        ['Smith Hall', 41.145756, -81.342094, '<h1><b>Smith Hall</b></h1>'],

        ['Intergrated Science Building and Williams Hall', 41.149385, -81.342477, '<h1><b>Intergrated Science Building and Williams Hall</b></h1>'],

        ['University Library', 41.146864, -81.342036, '<h1><b>University Library</b></h1>'],
        
        ['Kent Student  Center', 41.147924, -81.342511, '<h1><b>Kent Student  Center</b></h1>'],

        ['MACC Annex', 41.147982, -81.344297, '<h1><b>MACC Annex</b></h1>'],

        ['Center for Undergraduate Excellence', 41.148670, -81.345013, '<h1><b>Center for Undergraduate Excellence</b></h1>'],

        ['Bowman', 41.148580, -81.346597, '<h1><b>Bowman</b></h1>'],

        ['Satterfield', 41.148173, -81.347669, '<h1><b>Satterfield</b></h1>'],

        ['Taylor Hall', 41.150213, -81.344005, '<h1><b>Taylor Hall</b></h1>'],

        ['Business Administration Building', 41.149017, -81.348049, '<h1><b>Business Administration Building</b></h1>'],

        ['Center for the Visual Arts', 41.150261, -81.347436, '<h1><b>Center for the Visual Arts</b></h1>'],

        ['Kent State Center for Performing Arts', 41.152620, -81.340462, '<h1><b>Kent State Center for Performing Arts</b></h1>'],

        ['Nixson Hall', 41.152083, -81.341841, '<h1><b>Nixson Hall</b></h1>'],

        ['White Hall', 41.152733, -81.345912, '<h1><b>White Hall</b></h1>'],

        ['Moulton Hall', 41.152966, -81.346684, '<h1><b>Moulton Hall</b></h1>'],

        ['Lowry Hall', 41.152117, -81.347261, '<h1><b>Lowry Hall</b></h1>'],

        ['Merrill Hall', 41.151542, -81.348165, '<h1><b>Merrill Hall</b></h1>'],

        ['Cartwright Hall', 41.151224, -81.348798, '<h1><b>Cartwright Hall</b></h1>'],

        ['Kent Hall', 41.150930, -81.349428, '<h1><b>Kent Hall</b></h1>'],

        ['McGilvery Hall', 41.150877, -81.350912, '<h1><b>McGilvery Hall</b></h1>'],

        ['Center for Architecture and Enviromental Design', 41.152496, -81.352119, '<h1><b>Center for Architecture and Enviromental Design</b></h1>'],

        ['Franklin Hall', 41.151593, -81.350987, '<h1><b>Franklin Hall</b></h1>'],

        ['Rockwell Hall', 41.152810, -81.349923, '<h1><b>Rockwell Hall</b></h1>'],

        ['Oscar Richie Hall', 41.151435, -81.346570, '<h1><b>Oscar Richie Hall</b></h1>'],
        ];

        var infowindow = new google.maps.InfoWindow();

        for (i = 0; i < dispensers.length; i++) {  
        marker = new google.maps.Marker({
        position: new google.maps.LatLng(dispensers[i][1], dispensers[i][2]),
        map: map
        });

        google.maps.event.addListener(marker, 'click', (function(marker, i) {
        return function() {
          infowindow.setContent(dispensers[i][3]);
          infowindow.open(map, marker);
        }
        })(marker, i));

        }

        //create array of dispenser locations for distance matrix api
        var dispenserLocs = [];
        for (var i = 0; i < 15; ++i){
            dispenserLocs.push(dispensers[i][1] + "," + dispensers[i][2]);
        }
        console.log(dispenserLocs);
        console.log(pos);
        //set origin location based on postition
        var originLoc = [];
        //originLoc.push(pos["lat"] + "," + pos["lat"]);
        originLoc.push("41.144162, -81.341628");

        //specifications for shortest distance calling
        var query = {
            origins: originLoc,
            destinations: dispenserLocs,
            travelMode: google.maps.TravelMode.WALKING,
            unitSystem: google.maps.UnitSystem.IMPERIAL
        };

        getShortestDistance();

        function getShortestDistance() {

            dms.getDistanceMatrix(query, function(response, status) {
                if (status == "OK") {
                    //populateTable(response.rows);
                    //replace this later with function that will display the closest dispenser
                    console.log("we done did it dammit, we done did");
                    console.log(response);
                } else {
                    console.log(response + " " + status);
                }
            });
        }
}
</script>

<script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDgh8GWzkyvEprIotnrv-9ZYWvNQXpBCT8&callback=initMap">
</script>

<div id="mapNavContainer">
    <div id="map"></div>
        <ul id="navBarMap">
            <li><a class="active" href="/index">Main Menu</a></li>
            <li><a href="/about">About</a></li>
            <li><a href="/resources">Resources</a></li>
            <li><a href="/settings">Settings</a></li>
        </ul>
</div>




<script>
  // Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyCDD-Y_2pFxNWukf-bkdWDmlQD-mqSYBwk",
    authDomain: "ninja-firestore-tut-470a6.firebaseapp.com",
    databaseURL: "https://ninja-firestore-tut-470a6.firebaseio.com",
    projectId: "ninja-firestore-tut-470a6",
    storageBucket: "ninja-firestore-tut-470a6.appspot.com",
    messagingSenderId: "187246912286",
    appId: "1:187246912286:web:5c0b3b7a22b2d3180a9f0f",
    measurementId: "G-MLY5N0Z7R1"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  db.settings({ timestampsInSnapshots: true })
  //firebase.analytics();
</script>
<script>
    const dispensaryList = document.querySelector('#navBarMap');

function renderDispensary(doc) {
    let li = document.createElement('li');
    let building = document.createElement('span');

    li.setAttribute('data-id', doc.id);
    name.textContent = doc.data().building;

    li.appendChild(building);

    dispensaryList.appendChild(li);
}

db.collection('dispensaries').get().then((snapshot) => {
    snapshot.docs.forEach(doc => {
        renderDispensary(doc);
    })

})
</script>
{% endblock %}